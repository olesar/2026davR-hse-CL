---
title: "HW5: Correspondence analysis"
output: html_document
date: "2025-04-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r tidyverse, warning=FALSE, message=FALSE}
library(tidyverse)
```

### Данные 

В этом задании мы посмотрим на инфинитивную конструкцию со значением будущего времени (типа _буду писать_), а также близкие к ней конструкции с  начинательным (_начну писать_), модальным (_могу писать_) и волитивным (_хочу писать_) значением -- как они развивались в период старорусской письменности XV-XVII вв. В этот период происходила перестройка перифрастических конструкций, которые могут иметь референцию к будущему времени, выходили из употребления и появлялись новые вспомогательные глаголы (ср. _иму писати_ и _учну купити_), см., например, [Пенькова 2023](https://languagejournal.spbu.ru/article/view/18568/11770).  
Датасет `infinitives` был собран по данным Старорусского корпуса НКРЯ и представляет собой таблицу сопряженности употребления вспомогательных глаголов и инфинитивов. В этой версии представлены только самые часто встречающиеся инфинитивы.  
В ходе работы предстоит исследовать данные методом Анализа Соответствий и применить ряд других статистических методов анализа и визуализации.     

```{r data}
infinitives <- read_tsv("https://raw.githubusercontent.com/olesar/2025dav4compling/refs/heads/main/data/PeriphrasticFutureMidRussian.txt", col_names = TRUE) %>% as.data.frame() %>% select(!ends_with("_Imp")) %>% select(!быти_Lform) 
# сразу убираем сочетания инфинитива с формами имперфекта и с формой прошедшего времени глагола быть
```

### Проверка датасета 

Пользуясь столбцом `INF`, дайте имя каждому ряду таблицы сопряженности (с помощью функции `row.names` или `column_to_rownames`). Оставьте в таблице только целочисленные данные. Выведите первые 6 строк таблицы. Проверьте, что таблица не содержит missing data.  

```{r datasummary}

```

### Chisq test

Примените тест Хи-квадрат Пирсона к таблице сопряженности.

```{r chisq}


```

Постройте таблицу с ожидаемыми значениями для таблицы сопряженности.

```{r expected}


```

Предложите анализ теста Хи-квадрат. Что можно сказать об ассоциации между конструкциями (они обозначены вспомогательными глаголами в той или иной временной форме) и инфинитивами? Какие проблемы вы видите в применении теста Хи-квадрат к этим данным?

```{txt chisqconcl}

```

### Baloon plot

С помощью функции `balloonplot` визуализируем данные в таблице сопряженности.

```{r baloon}
library("gplots")
infinitives |> as.matrix() |> as.table() |>
  balloonplot(main ="", xlab ="", ylab="",
              label = FALSE, show.margins = FALSE, text.size=0.5, colsrt=45, colmar=3, rowmar=3)
```

### Хи-квадрат на меньшей таблице 

Оставьте меньшее количество строк и столбцов в таблице (вы можете убирать те или иные столбцы или объединять данные из нескольких столбцов или строк). Результирующая таблица должна быть размером не меньше 3 x 3 и корректна для проведения теста Хи-квадрат. Проведите снова тест Хи-квадрат и запишите ваши выводы. 

```{r chisq2}

```

Вычислите величину эффекта для теста с помощью V Крамера. 

```{r effectsize}

```

Визуализируйте таблицу с помощью мозаичного графика. 

```{r mosaicplot}

```

Запишите ваши выводы по ассоциации данных в меньшей таблице.

```{txt chisq2concl}

```

### Интерактивная тепловая карта  

Вернемся к полной таблице сопряженности. Используйте функцию `heatmaply` для интерактивной визуализации ассоциации между строками и столбцами. 

```{r heatmap}
library(heatmaply) ## for constructing interactive heatmap

```


### Анализ соответствий  

В этом разделе мы предлагаем использовать пакеты `factoextra` и `FactoMineR`, но вы можете использовать и другие пакеты R. 
Постройте модель анализа соответствий и запишите ее в переменную `ca.model`. Выведите summary модели.  

```{r with FacroMineR}
library(factoextra)
library(FactoMineR)


```

### Screeplot

Визуализируйте screeplot. 

```{r screeplot}

```

Запишите ваши выводы, какую долю объясненной дисперсии представляют первые два измерения?

```{r dims}

```

### Biplot  

Постройте базовый биплот. 

```{r biplot}


```

Постройте плот для данных в столбцах. Цвет должен отражать сontribution каждого конкретного столбца. 

```{r varplot}


```

Здесь вы можете построить более продвинутый биплот с использованием цвета, прозрачности, repel. 

```{r biplot2}


```

### Выводы  

Предложите ваш анализ визуализаций, полученных методом Анализа соответствий. 

```{txt ca-concl}


```


### Дополнительное задание  

1) Посчитайте метрику pmi (pointwise mutual information) для сочетания каждой конструкции и каждого инфинитива. 
2) Выведите топ-10 пар с наибольшим значением метрики. 
3) Визуализируйте данные с помощью коррелограммы, используя функцию `corrplot` из одноименного пакета.
4) Постройте 2D-визуализацию получившейся таблицы с непрерывными данными, пользуясь Методом главных компонент (PC1 и PC2).  
5) Запишите ваши выводы по анализу PCA. 
6) Сравните результаты CA и PCA.

```{r additional}



```

